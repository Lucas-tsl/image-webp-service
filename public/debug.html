<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Debug - Convertisseur</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 20px;
    }
    .debug-info {
      background: #e8f4f8;
      padding: 15px;
      border-radius: 5px;
      margin: 10px 0;
      border-left: 4px solid #007bff;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #0056b3;
    }
    .form-group {
      margin: 15px 0;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîß Debug - Convertisseur d'images</h1>
    
    <div class="debug-info">
      <strong>Status:</strong> Page charg√©e correctement ‚úÖ
    </div>

    <form action="/upload" method="POST" enctype="multipart/form-data">
      <div class="form-group">
        <label for="images">S√©lectionnez vos images:</label>
        <input type="file" id="images" name="images" accept="image/*" multiple required>
      </div>

      <div class="form-group">
        <label for="quality">Qualit√© (1-100):</label>
        <input type="number" id="quality" name="quality" value="70" min="1" max="100" required>
      </div>

      <div class="form-group">
        <label for="format">Format de sortie:</label>
        <select id="format" name="format">
          <option value="webp" selected>WebP</option>
          <option value="avif">AVIF</option>
          <option value="jpeg">JPEG</option>
        </select>
      </div>

      <button type="submit">Convertir les images</button>
    </form>

    <div class="debug-info">
      <strong>Actions de test:</strong><br>
      <button onclick="testJS()">Test JavaScript</button>
      <button onclick="testServerHealth()">Test Sant√© Serveur</button>
      <button onclick="testServer()">Test Upload</button>
      <button onclick="testMainPage()">Test Page Principale</button>
      <button onclick="showInfo()">Infos Debug</button>
    </div>

    <div id="testResults"></div>
  </div>

  <script>
    // Test JavaScript
    function testJS() {
      const results = document.getElementById('testResults');
      results.innerHTML = `
        <div class="debug-info">
          <strong>Test JavaScript:</strong> ‚úÖ Fonctionne<br>
          <strong>Date:</strong> ${new Date().toLocaleString()}<br>
          <strong>User Agent:</strong> ${navigator.userAgent.substring(0, 50)}...
        </div>
      `;
    }

    // Test de sant√© du serveur
    function testServerHealth() {
      const results = document.getElementById('testResults');
      results.innerHTML = '<div class="debug-info"><strong>Test de sant√© du serveur...</strong></div>';
      
      fetch('/api/health', {
        method: 'GET'
      })
      .then(response => {
        if (response.ok) {
          return response.json();
        }
        throw new Error(`HTTP ${response.status}`);
      })
      .then(data => {
        results.innerHTML = `
          <div class="debug-info">
            <strong>Test Sant√© Serveur:</strong> ‚úÖ ${data.status}<br>
            <strong>Uptime:</strong> ${Math.floor(data.uptime)} secondes<br>
            <strong>M√©moire:</strong> ${Math.round(data.memory.heapUsed / 1024 / 1024)} MB<br>
            <strong>Version:</strong> ${data.version}<br>
            <strong>Timestamp:</strong> ${new Date(data.timestamp).toLocaleString()}
          </div>
        `;
      })
      .catch(error => {
        results.innerHTML = `
          <div class="debug-info">
            <strong>Test Sant√© Serveur:</strong> ‚ùå Erreur<br>
            <strong>D√©tails:</strong> ${error.message}
          </div>
        `;
      });
    }

    // Test du serveur
    function testServer() {
      const results = document.getElementById('testResults');
      results.innerHTML = '<div class="debug-info"><strong>Test en cours...</strong></div>';
      
      // Test avec FormData vide (doit retourner 400 car pas d'images)
      const formData = new FormData();
      fetch('/upload', {
        method: 'POST',
        body: formData
      })
      .then(response => {
        const isSuccess = response.status === 400; // 400 est attendu sans fichiers
        results.innerHTML = `
          <div class="debug-info">
            <strong>Test Serveur:</strong> ${isSuccess ? '‚úÖ Fonctionne' : '‚ùå Probl√®me'}<br>
            <strong>Status:</strong> ${response.status}<br>
            <strong>Explication:</strong> ${response.status === 400 ? 'Normal - Pas de fichiers envoy√©s' : 'R√©ponse inattendue'}
          </div>
        `;
      })
      .catch(error => {
        results.innerHTML = `
          <div class="debug-info">
            <strong>Test Serveur:</strong> ‚ùå Erreur de connexion<br>
            <strong>D√©tails:</strong> ${error.message}<br>
            <strong>Solution:</strong> V√©rifiez que le serveur Node.js est d√©marr√©
          </div>
        `;
      });
    }

    // Test de la page principale
    function testMainPage() {
      const results = document.getElementById('testResults');
      results.innerHTML = '<div class="debug-info"><strong>Test de la page principale en cours...</strong></div>';
      
      fetch('/', {
        method: 'GET'
      })
      .then(response => {
        if (response.ok) {
          return response.text();
        }
        throw new Error(`HTTP ${response.status}`);
      })
      .then(html => {
        const hasTitle = html.includes('<title>');
        const hasForm = html.includes('<form');
        const hasCSS = html.includes('<style>');
        const hasJS = html.includes('<script>');
        
        results.innerHTML = `
          <div class="debug-info">
            <strong>Test Page Principale:</strong> ‚úÖ Accessible<br>
            <strong>Contenu HTML:</strong> ${hasTitle ? '‚úÖ' : '‚ùå'} Title<br>
            <strong>Formulaire:</strong> ${hasForm ? '‚úÖ' : '‚ùå'} Form<br>
            <strong>CSS:</strong> ${hasCSS ? '‚úÖ' : '‚ùå'} Styles<br>
            <strong>JavaScript:</strong> ${hasJS ? '‚úÖ' : '‚ùå'} Scripts<br>
            <strong>Taille:</strong> ${html.length} caract√®res
          </div>
        `;
      })
      .catch(error => {
        results.innerHTML = `
          <div class="debug-info">
            <strong>Test Page Principale:</strong> ‚ùå Erreur<br>
            <strong>D√©tails:</strong> ${error.message}
          </div>
        `;
      });
    }

    // Afficher les infos de debug
    function showInfo() {
      const results = document.getElementById('testResults');
      results.innerHTML = `
        <div class="debug-info">
          <strong>Infos Debug:</strong><br>
          <strong>URL:</strong> ${window.location.href}<br>
          <strong>R√©solution:</strong> ${window.innerWidth}x${window.innerHeight}<br>
          <strong>Cookies:</strong> ${document.cookie || 'Aucun'}<br>
          <strong>Local Storage:</strong> ${localStorage.length} items
        </div>
      `;
    }

    // Auto-test au chargement
    window.addEventListener('load', function() {
      console.log('Page charg√©e avec succ√®s');
      testJS();
    });
  </script>
</body>
</html>
